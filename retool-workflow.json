{"uuid":"a34623d4-9c40-11ef-a628-43afcbf43c89","page":{"id":339400679,"data":{"appState":"[\"~#iR\",[\"^ \",\"n\",\"appTemplate\",\"v\",[\"^ \",\"appMaxWidth\",\"100%\",\"appStyles\",\"\",\"appTesting\",null,\"appThemeId\",null,\"appThemeModeId\",null,\"appThemeName\",null,\"createdAt\",null,\"customComponentCollections\",[],\"customDocumentTitle\",\"\",\"customDocumentTitleEnabled\",false,\"customShortcuts\",[],\"experimentalDataTabEnabled\",false,\"experimentalFeatures\",[\"^ \",\"sourceControlTemplateDehydration\",false,\"multiplayerEditingEnabled\",false,\"disableMultiplayerEditing\",false],\"folders\",[\"~#iL\",[]],\"formAppSettings\",[\"^ \",\"customRedirectUrl\",\"\"],\"inAppRetoolPillAppearance\",\"NO_OVERRIDE\",\"instrumentationEnabled\",false,\"internationalizationSettings\",[\"^ \",\"internationalizationEnabled\",false,\"internationalizationFiles\",[]],\"isFetching\",false,\"isFormApp\",false,\"isGlobalWidget\",false,\"isMobileApp\",false,\"loadingIndicatorsDisabled\",false,\"markdownLinkBehavior\",\"auto\",\"mobileAppSettings\",[\"^ \",\"mobileOfflineModeEnabled\",false,\"mobileOfflineModeDelaySync\",false,\"mobileOfflineModeBannerMode\",\"default\",\"displaySetting\",[\"^ \",\"landscapeMode\",false,\"tabletMode\",false]],\"mobileOfflineAssets\",[],\"multiScreenMobileApp\",false,\"notificationsSettings\",[\"^ \",\"globalQueryShowFailureToast\",true,\"globalQueryShowSuccessToast\",false,\"globalQueryToastDuration\",4.5],\"pageCodeFolders\",[\"^ \"],\"pageLoadValueOverrides\",[\"^B\",[]],\"plugins\",[\"~#iOM\",[\"$main\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"$main\",\"uuid\",null,\"type\",\"frame\",\"subtype\",\"Frame\",\"namespace\",null,\"resourceName\",null,\"resourceDisplayName\",null,\"template\",[\"^14\",[\"type\",\"main\",\"padding\",\"8px 12px\",\"enableFullBleed\",true]],\"style\",[\"^14\",[]],\"position2\",null,\"mobilePosition2\",null,\"mobileAppPosition\",null,\"tabIndex\",null,\"container\",\"\",\"^7\",\"~m1697419274888\",\"updatedAt\",\"~m1708219663251\",\"folder\",\"\",\"screen\",null]]],\"container1\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"container1\",\"^15\",\"b69d36cc-a030-4fd8-9997-a8a1a20afa8e\",\"^16\",\"widget\",\"^17\",\"ContainerWidget2\",\"^18\",null,\"^19\",null,\"^1:\",null,\"^1;\",[\"^14\",[\"_direction\",\"horizontal\",\"_disabledByIndex\",[\"^B\",[\"\"]],\"heightType\",\"fixed\",\"currentViewKey\",null,\"iconByIndex\",[],\"_flexWrap\",false,\"clickable\",false,\"_iconByIndex\",[\"^B\",[\"\"]],\"headerPadding\",\"4px 12px\",\"showFooterBorder\",true,\"_align\",\"start\",\"enableFullBleed\",true,\"showBorder\",true,\"hidden\",false,\"showHeader\",true,\"hoistFetching\",false,\"margin\",\"4px 8px\",\"views\",[],\"showInEditor\",false,\"tooltipText\",\"\",\"padding\",\"12px\",\"_justify\",\"start\",\"hiddenByIndex\",[],\"_hiddenByIndex\",[\"^B\",[\"\"]],\"currentViewIndex\",null,\"_hasMigratedNestedItems\",true,\"transition\",\"none\",\"showHeaderBorder\",true,\"footerPadding\",\"4px 12px\",\"itemMode\",\"static\",\"_gap\",\"0px\",\"_tooltipByIndex\",[\"^B\",[\"\"]],\"tooltipByIndex\",[],\"showFooter\",false,\"_viewKeys\",[\"^B\",[\"View 1\"]],\"_type\",\"grid\",\"events\",[\"^14\",[]],\"_ids\",[\"^B\",[\"04101\"]],\"viewKeys\",[],\"iconPositionByIndex\",[],\"_iconPositionByIndex\",[\"^B\",[\"\"]],\"hovered\",false,\"loading\",\"{{ filterRenderedInvoicesFromFolios.data == null }}\",\"overflowType\",\"scroll\",\"disabled\",false,\"_labels\",[\"^B\",[\"\"]],\"disabledByIndex\",[],\"maintainSpaceWhenHidden\",false,\"showBody\",true,\"labels\",[]]],\"^1<\",[\"^14\",[]],\"^1=\",[\"^0\",[\"^ \",\"n\",\"position2\",\"v\",[\"^ \",\"^16\",\"grid\",\"^1A\",\"\",\"rowGroup\",\"body\",\"subcontainer\",\"\",\"row\",0.6,\"col\",2,\"height\",18.8,\"width\",6,\"tabNum\",0,\"stackPosition\",[\"^ \",\"ordinal\",0,\"widthType\",\"fixed\",\"^1H\",0,\"^1G\",0]]]],\"^1>\",null,\"^1?\",null,\"^1@\",null,\"^1A\",\"\",\"^7\",\"~m1708219659246\",\"^1B\",\"~m1730387721848\",\"^1C\",\"\",\"^1D\",null]]],\"containerTitle1\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"containerTitle1\",\"^15\",\"380f0dd5-2a52-49f2-bf2a-3aa3a0636af9\",\"^16\",\"widget\",\"^17\",\"TextWidget2\",\"^18\",null,\"^19\",null,\"^1:\",null,\"^1;\",[\"^14\",[\"heightType\",\"auto\",\"horizontalAlign\",\"left\",\"hidden\",false,\"imageWidth\",\"fit\",\"margin\",\"4px 8px\",\"showInEditor\",false,\"verticalAlign\",\"center\",\"tooltipText\",\"\",\"value\",\"#### FAILED INVOICES\",\"disableMarkdown\",false,\"overflowType\",\"scroll\",\"maintainSpaceWhenHidden\",false]],\"^1<\",[\"^14\",[]],\"^1=\",[\"^0\",[\"^ \",\"n\",\"position2\",\"v\",[\"^ \",\"^16\",\"grid\",\"^1A\",\"container1\",\"^1E\",\"header\",\"^1F\",\"\",\"row\",0.4,\"col\",0,\"^1G\",0.6,\"^1H\",12,\"^1I\",0,\"^1J\",null]]],\"^1>\",null,\"^1?\",null,\"^1@\",null,\"^1A\",\"\",\"^7\",\"~m1708219659275\",\"^1B\",\"~m1730129115195\",\"^1C\",\"\",\"^1D\",null]]],\"getFailedInvoices\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"getFailedInvoices\",\"^15\",null,\"^16\",\"datasource\",\"^17\",\"OpenAPIQuery\",\"^18\",null,\"^19\",\"8b4621f0-e774-44ae-91a2-4815fbf9dfcd\",\"^1:\",\"Apaleo Fiscalization NSFW (FTMG)\",\"^1;\",[\"^14\",[\"queryRefreshTime\",\"\",\"requestBodyMetadata\",\"\",\"method\",\"get\",\"allowedGroupIds\",[\"^B\",[]],\"streamResponse\",false,\"operationId\",\"FinanceInvoicesGet\",\"lastReceivedFromResourceAt\",null,\"queryDisabledMessage\",\"\",\"servedFromCache\",false,\"server\",\"https://undefined\",\"offlineUserQueryInputs\",\"\",\"successMessage\",\"\",\"queryDisabled\",\"\",\"path\",\"/finance/v0-nsfw/invoices\",\"playgroundQuerySaveId\",\"latest\",\"workflowParams\",null,\"resourceNameOverride\",\"\",\"runWhenModelUpdates\",true,\"autoPaginate\",false,\"showFailureToaster\",true,\"query\",\"\",\"playgroundQueryUuid\",\"\",\"playgroundQueryId\",null,\"error\",null,\"workflowRunBodyType\",\"raw\",\"privateParams\",[\"^B\",[]],\"queryRunOnSelectorUpdate\",false,\"runWhenPageLoadsDelay\",\"\",\"parameters\",\"{\\\"lifecycleStatus\\\":\\\"SigningFailed\\\",\\\"invoiceDateFilter\\\":\\\"['gte_{{ dateRange1.value.start}}',\\\\n'lte_{{ dateRange1.value.end}}'\\\\n]\\\",\\\"propertyIds\\\":[\\\"FKP\\\"]}\",\"data\",null,\"specPathOverride\",\"\",\"importedQueryInputs\",[\"^14\",[]],\"isImported\",false,\"showSuccessToaster\",false,\"cacheKeyTtl\",\"\",\"requestSentTimestamp\",null,\"metadata\",null,\"requestBodyDynamicStates\",\"\",\"queryRunTime\",null,\"changesetObject\",\"\",\"requestBody\",\"\",\"offlineOptimisticResponse\",null,\"errorTransformer\",\"return data.error\",\"specBasePath\",\"https://undefined\",\"finished\",null,\"confirmationMessage\",null,\"isFetching\",false,\"changeset\",\"\",\"rawData\",null,\"queryTriggerDelay\",\"0\",\"resourceTypeOverride\",\"\",\"watchedParams\",[\"^B\",[]],\"serverVariables\",\"\",\"enableErrorTransformer\",false,\"autoPaginateLimit\",500,\"showLatestVersionUpdatedWarning\",false,\"timestamp\",0,\"importedQueryDefaults\",[\"^14\",[]],\"enableTransformer\",true,\"showUpdateSetValueDynamicallyToggle\",true,\"parameterDynamicStates\",\"{\\\"number\\\":false,\\\"settlementStatus\\\":false,\\\"lifecycleStatus\\\":false,\\\"invoiceDateFilter\\\":false,\\\"amountReceivableFilter\\\":false,\\\"invoiceAmountFilter\\\":false,\\\"invoiceIds\\\":false,\\\"propertyIds\\\":false,\\\"reservationIds\\\":false,\\\"bookingIds\\\":false,\\\"folioIds\\\":false,\\\"textSearch\\\":false,\\\"companyIds\\\":false,\\\"pageNumber\\\":false,\\\"pageSize\\\":false,\\\"sort\\\":false,\\\"expand\\\":false}\",\"parameterMetadata\",\"{}\",\"overrideOrgCacheForUserCache\",false,\"runWhenPageLoads\",false,\"transformer\",\"let invoices = data.invoices\\nreturn invoices\",\"events\",[\"^B\",[[\"^14\",[\"event\",\"success\",\"type\",\"datasource\",\"method\",\"trigger\",\"pluginId\",\"getRenderedInvoices\",\"targetId\",null,\"params\",[\"^14\",[\"options\",[\"^14\",[\"onSuccess\",null,\"onFailure\",null,\"additionalScope\",null]]]],\"waitType\",\"debounce\",\"waitMs\",\"0\"]],[\"^14\",[\"event\",\"failure\",\"type\",\"datasource\",\"method\",\"trigger\",\"pluginId\",\"\",\"targetId\",null,\"params\",[\"^14\",[]],\"waitType\",\"debounce\",\"waitMs\",\"0\"]]]],\"isMultiplayerEdited\",false,\"queryTimeout\",\"10000\",\"workflowId\",null,\"requireConfirmation\",false,\"queryFailureConditions\",\"\",\"changesetIsObject\",false,\"enableCaching\",false,\"allowedGroups\",[\"^B\",[]],\"offlineQueryType\",\"None\",\"queryThrottleTime\",\"750\",\"updateSetValueDynamically\",false,\"notificationDuration\",4.5]],\"^1<\",null,\"^1=\",null,\"^1>\",null,\"^1?\",null,\"^1@\",null,\"^1A\",\"\",\"^7\",\"~m1730120321007\",\"^1B\",\"~m1730811634891\",\"^1C\",\"\",\"^1D\",null]]],\"getRenderedInvoices\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"getRenderedInvoices\",\"^15\",null,\"^16\",\"datasource\",\"^17\",\"OpenAPIQuery\",\"^18\",null,\"^19\",\"8b4621f0-e774-44ae-91a2-4815fbf9dfcd\",\"^1:\",\"Apaleo Fiscalization NSFW (FTMG)\",\"^1;\",[\"^14\",[\"queryRefreshTime\",\"\",\"requestBodyMetadata\",\"\",\"method\",\"get\",\"allowedGroupIds\",[\"^B\",[]],\"streamResponse\",false,\"operationId\",\"FinanceInvoicesGet\",\"lastReceivedFromResourceAt\",null,\"queryDisabledMessage\",\"\",\"servedFromCache\",false,\"server\",\"\",\"offlineUserQueryInputs\",\"\",\"successMessage\",\"\",\"queryDisabled\",\"\",\"path\",\"/finance/v0-nsfw/invoices\",\"playgroundQuerySaveId\",\"latest\",\"workflowParams\",null,\"resourceNameOverride\",\"\",\"runWhenModelUpdates\",true,\"autoPaginate\",false,\"showFailureToaster\",true,\"query\",\"\",\"playgroundQueryUuid\",\"\",\"playgroundQueryId\",null,\"error\",null,\"workflowRunBodyType\",\"raw\",\"privateParams\",[\"^B\",[]],\"queryRunOnSelectorUpdate\",false,\"runWhenPageLoadsDelay\",\"\",\"parameters\",\"{\\\"lifecycleStatus\\\":\\\"Rendered\\\",\\\"invoiceDateFilter\\\":\\\"['gte_{{ dateRange1.value.start}}',\\\\n'lte_{{ dateRange1.value.end}}'\\\\n]\\\",\\\"propertyIds\\\":[\\\"FKP\\\"]}\",\"data\",null,\"specPathOverride\",\"\",\"importedQueryInputs\",[\"^14\",[]],\"isImported\",false,\"showSuccessToaster\",false,\"cacheKeyTtl\",\"\",\"requestSentTimestamp\",null,\"metadata\",null,\"requestBodyDynamicStates\",\"\",\"queryRunTime\",null,\"changesetObject\",\"\",\"requestBody\",\"\",\"offlineOptimisticResponse\",null,\"errorTransformer\",\"return data.error\",\"specBasePath\",\"\",\"finished\",null,\"confirmationMessage\",null,\"isFetching\",false,\"changeset\",\"\",\"rawData\",null,\"queryTriggerDelay\",\"0\",\"resourceTypeOverride\",\"\",\"watchedParams\",[\"^B\",[]],\"serverVariables\",\"\",\"enableErrorTransformer\",false,\"autoPaginateLimit\",500,\"showLatestVersionUpdatedWarning\",false,\"timestamp\",0,\"importedQueryDefaults\",[\"^14\",[]],\"enableTransformer\",true,\"showUpdateSetValueDynamicallyToggle\",true,\"parameterDynamicStates\",\"{\\\"number\\\":false,\\\"settlementStatus\\\":false,\\\"lifecycleStatus\\\":false,\\\"invoiceDateFilter\\\":false,\\\"amountReceivableFilter\\\":false,\\\"invoiceAmountFilter\\\":false,\\\"invoiceIds\\\":false,\\\"propertyIds\\\":false,\\\"reservationIds\\\":false,\\\"bookingIds\\\":false,\\\"folioIds\\\":false,\\\"textSearch\\\":false,\\\"companyIds\\\":false,\\\"pageNumber\\\":false,\\\"pageSize\\\":false,\\\"sort\\\":false,\\\"expand\\\":false}\",\"parameterMetadata\",\"{}\",\"overrideOrgCacheForUserCache\",false,\"runWhenPageLoads\",false,\"transformer\",\"let invoices = data.invoices\\nreturn invoices\",\"events\",[\"^B\",[[\"^14\",[\"event\",\"success\",\"type\",\"datasource\",\"method\",\"trigger\",\"pluginId\",\"filterRenderedInvoicesFromFolios\",\"targetId\",null,\"params\",[\"^14\",[\"options\",[\"^14\",[\"onSuccess\",null,\"onFailure\",null,\"additionalScope\",null]]]],\"waitType\",\"debounce\",\"waitMs\",\"0\"]]]],\"isMultiplayerEdited\",false,\"queryTimeout\",\"10000\",\"workflowId\",null,\"requireConfirmation\",false,\"queryFailureConditions\",\"\",\"changesetIsObject\",false,\"enableCaching\",false,\"allowedGroups\",[\"^B\",[]],\"offlineQueryType\",\"None\",\"queryThrottleTime\",\"750\",\"updateSetValueDynamically\",false,\"notificationDuration\",4.5]],\"^1<\",null,\"^1=\",null,\"^1>\",null,\"^1?\",null,\"^1@\",null,\"^1A\",\"\",\"^7\",\"~m1730193666045\",\"^1B\",\"~m1730811645915\",\"^1C\",\"\",\"^1D\",null]]],\"filterRenderedInvoicesFromFolios\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"filterRenderedInvoicesFromFolios\",\"^15\",null,\"^16\",\"datasource\",\"^17\",\"JavascriptQuery\",\"^18\",null,\"^19\",\"JavascriptQuery\",\"^1:\",null,\"^1;\",[\"^14\",[\"queryRefreshTime\",\"\",\"allowedGroupIds\",[\"^B\",[]],\"streamResponse\",false,\"lastReceivedFromResourceAt\",null,\"queryDisabledMessage\",\"\",\"servedFromCache\",false,\"offlineUserQueryInputs\",\"\",\"successMessage\",\"\",\"queryDisabled\",\"\",\"playgroundQuerySaveId\",\"latest\",\"workflowParams\",null,\"resourceNameOverride\",\"\",\"runWhenModelUpdates\",false,\"showFailureToaster\",true,\"query\",\"// This script orchestrates the endpoints needed to see failed invoices that haven't been rendered\\n// 1. Fetch all failed invoices in a date range (getFailedInvoices)\\n// 2. Fetch \\\"Rendered\\\" invoices in the same date range (getRenderedInvoices)\\n// 3. Remove rendered invoices from the failed invoices using the folio ids, \\n// 4. Only show the latest invoice from the same folio\\n// 5. Query Retool database to see if there is failure reason for an invoice.\\n\\nasync function findUnrenderedInvoices(failedInvoices, renderedInvoices) {\\n  // Create a Set of \\\"folioId\\\" values from renderedInvoices\\n  const renderedFolioIds = new Set(renderedInvoices.map(invoice => invoice.folioId));\\n\\n  // Filter failedInvoices to only include those with folioId not in renderedFolioIds\\n  const unrenderedInvoices = failedInvoices.filter(invoice => !renderedFolioIds.has(invoice.folioId));\\n\\n  // Reduce to keep only the latest invoice for each unique folioId\\n  const uniqueLatestInvoices = unrenderedInvoices.reduce((acc, invoice) => {\\n\\n    const existingInvoice = acc.find(item => item.folioId === invoice.folioId);\\n\\n    if (!existingInvoice || new Date(invoice.invoiceDate) > new Date(existingInvoice.invoiceDate)) {\\n      return [\\n        ...acc.filter(item => item.folioId !== invoice.folioId),\\n        invoice\\n      ];\\n    }\\n      \\n    return acc;\\n  }, []);\\n\\n  // Get all invoice numbers for database query\\n  const invoiceNumbersArr = uniqueLatestInvoices.reduce((acc, invoice) => {\\n    if (invoice.number != null) {\\n      acc.push(invoice.number);\\n    }\\n    return acc\\n  }, [])\\n\\n  \\n  \\n  let errorMap = new Map();\\n\\n  // Query the Retool database for errors\\n  async function callGetInvoiceErrors() {\\n    return await getInvoiceErrors.trigger({\\n      onSuccess: (data) => {\\n        console.log(\\\"Data is\\\", data)\\n      },\\n      onFailure: (error) => {\\n        console.log(\\\"Error is\\\", error)\\n      },\\n      additionalScope: {\\n        invoiceNumbers: invoiceNumbersArr\\n      } \\n    });\\n  }\\n  \\n  if (invoiceNumbersArr.length > 0) {\\n    const errorResults = await callGetInvoiceErrors();\\n    console.log(errorResults)\\n    // Create a map of invoice_number to errors for easy lookup\\n    console.log(\\\"retrieved data\\\", errorResults)\\n\\n    const formattedErrors = formatDataAsArray(errorResults)\\n    \\n    errorMap = new Map(\\n      formattedErrors.map(invoice => [invoice.invoice_number, invoice.errors])\\n    );\\n  }\\n\\n  // Add errors property to all invoices (null if no errors found)\\n  const invoicesWithErrors = uniqueLatestInvoices.map(invoice => ({\\n    ...invoice,\\n    errors: errorMap.get(invoice.number) || null\\n  }));\\n\\n  return invoicesWithErrors;\\n}\\n\\nconst failedInvoices = getFailedInvoices.data;\\nconst renderedInvoices = getRenderedInvoices.data;\\nconst unrenderedInvoices = findUnrenderedInvoices(failedInvoices, renderedInvoices);\\n\\n\\nreturn unrenderedInvoices;\",\"playgroundQueryUuid\",\"\",\"playgroundQueryId\",null,\"error\",null,\"workflowRunBodyType\",\"raw\",\"privateParams\",[\"^B\",[]],\"queryRunOnSelectorUpdate\",false,\"runWhenPageLoadsDelay\",\"\",\"data\",null,\"importedQueryInputs\",[\"^14\",[]],\"_additionalScope\",[\"^B\",[]],\"isImported\",false,\"showSuccessToaster\",false,\"cacheKeyTtl\",\"\",\"requestSentTimestamp\",null,\"metadata\",null,\"queryRunTime\",null,\"changesetObject\",\"\",\"offlineOptimisticResponse\",null,\"errorTransformer\",\"return data.error\",\"finished\",null,\"confirmationMessage\",null,\"isFetching\",false,\"changeset\",\"\",\"rawData\",null,\"queryTriggerDelay\",\"0\",\"resourceTypeOverride\",null,\"watchedParams\",[\"^B\",[]],\"enableErrorTransformer\",false,\"showLatestVersionUpdatedWarning\",false,\"timestamp\",0,\"importedQueryDefaults\",[\"^14\",[]],\"enableTransformer\",false,\"showUpdateSetValueDynamicallyToggle\",true,\"overrideOrgCacheForUserCache\",false,\"runWhenPageLoads\",false,\"transformer\",\"return data\",\"events\",[\"^B\",[]],\"isMultiplayerEdited\",false,\"queryTimeout\",\"10000\",\"workflowId\",null,\"requireConfirmation\",false,\"queryFailureConditions\",\"\",\"changesetIsObject\",false,\"enableCaching\",false,\"allowedGroups\",[\"^B\",[]],\"offlineQueryType\",\"None\",\"queryThrottleTime\",\"750\",\"updateSetValueDynamically\",false,\"notificationDuration\",4.5]],\"^1<\",null,\"^1=\",null,\"^1>\",null,\"^1?\",null,\"^1@\",null,\"^1A\",\"\",\"^7\",\"~m1730196827293\",\"^1B\",\"~m1730905468398\",\"^1C\",\"\",\"^1D\",null]]],\"getInvoiceErrors\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"getInvoiceErrors\",\"^15\",null,\"^16\",\"datasource\",\"^17\",\"SqlQueryUnified\",\"^18\",null,\"^19\",\"44587274-b70c-4179-b6b5-12a48105ff64\",\"^1:\",\"retool_db\",\"^1;\",[\"^14\",[\"queryRefreshTime\",\"\",\"allowedGroupIds\",[\"^B\",[]],\"streamResponse\",false,\"records\",\"\",\"lastReceivedFromResourceAt\",null,\"databasePasswordOverride\",\"\",\"queryDisabledMessage\",\"\",\"servedFromCache\",false,\"offlineUserQueryInputs\",\"\",\"successMessage\",\"\",\"queryDisabled\",\"\",\"playgroundQuerySaveId\",\"latest\",\"workflowParams\",null,\"resourceNameOverride\",\"\",\"runWhenModelUpdates\",false,\"showFailureToaster\",true,\"query\",\"SELECT\\n  invoice_number,\\n  errors\\nFROM\\n  fonoa_failures_fkp\\nWHERE\\n  invoice_number = ANY({{invoiceNumbers}})\",\"playgroundQueryUuid\",\"\",\"playgroundQueryId\",null,\"error\",null,\"workflowRunBodyType\",\"raw\",\"privateParams\",[\"^B\",[]],\"queryRunOnSelectorUpdate\",false,\"runWhenPageLoadsDelay\",\"\",\"warningCodes\",[\"^B\",[]],\"data\",null,\"recordId\",\"\",\"importedQueryInputs\",[\"^14\",[]],\"_additionalScope\",[\"^B\",[\"invoiceNumbers\"]],\"isImported\",false,\"showSuccessToaster\",true,\"dataArray\",[\"^B\",[]],\"cacheKeyTtl\",\"\",\"filterBy\",\"\",\"requestSentTimestamp\",null,\"databaseHostOverride\",\"\",\"metadata\",null,\"editorMode\",\"sql\",\"queryRunTime\",null,\"actionType\",\"\",\"changesetObject\",\"\",\"shouldUseLegacySql\",false,\"offlineOptimisticResponse\",null,\"errorTransformer\",\"return data.error\",\"finished\",null,\"databaseNameOverride\",\"\",\"confirmationMessage\",null,\"isFetching\",false,\"changeset\",\"\",\"rawData\",null,\"queryTriggerDelay\",\"0\",\"resourceTypeOverride\",\"\",\"watchedParams\",[\"^B\",[]],\"enableErrorTransformer\",false,\"databaseWarehouseOverride\",\"\",\"enableBulkUpdates\",false,\"showLatestVersionUpdatedWarning\",false,\"timestamp\",0,\"importedQueryDefaults\",[\"^14\",[]],\"enableTransformer\",false,\"showUpdateSetValueDynamicallyToggle\",true,\"overrideOrgCacheForUserCache\",false,\"bulkUpdatePrimaryKey\",\"\",\"runWhenPageLoads\",false,\"transformer\",\"return data\",\"events\",null,\"isMultiplayerEdited\",false,\"tableName\",\"\",\"queryTimeout\",\"10000\",\"workflowId\",null,\"requireConfirmation\",false,\"queryFailureConditions\",\"\",\"changesetIsObject\",false,\"enableCaching\",false,\"allowedGroups\",[\"^B\",[]],\"databaseUsernameOverride\",\"\",\"databaseRoleOverride\",\"\",\"shouldEnableBatchQuerying\",false,\"doNotThrowOnNoOp\",false,\"offlineQueryType\",\"None\",\"queryThrottleTime\",\"750\",\"updateSetValueDynamically\",false,\"notificationDuration\",\"\"]],\"^1<\",null,\"^1=\",null,\"^1>\",null,\"^1?\",null,\"^1@\",null,\"^1A\",\"\",\"^7\",\"~m1730896066885\",\"^1B\",\"~m1730905168700\",\"^1C\",\"\",\"^1D\",null]]],\"dateRange1\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"dateRange1\",\"^15\",\"f636d288-b7a1-4aba-ab56-295587a0c6cb\",\"^16\",\"widget\",\"^17\",\"DateRangeWidget\",\"^18\",null,\"^19\",null,\"^1:\",null,\"^1;\",[\"^14\",[\"minDate\",\"\",\"readOnly\",false,\"iconAfter\",\"\",\"dateFormat\",\"MMM d, yyyy\",\"hidden\",false,\"customValidation\",\"\",\"hideValidationMessage\",false,\"textBefore\",\"\",\"validationMessage\",\"\",\"margin\",\"4px 8px\",\"textAfter\",\"\",\"showInEditor\",false,\"showClear\",false,\"tooltipText\",\"\",\"labelAlign\",\"left\",\"formDataKey\",\"{{ self.id }}\",\"value\",[\"^14\",[\"start\",\"{{  moment().subtract(1, 'months').format('YYYY-MM-DD') }}\",\"end\",\"{{ moment().format('YYYY-MM-DD') }}\"]],\"startPlaceholder\",\"Start date\",\"labelCaption\",\"\",\"maxDate\",\"\",\"labelWidth\",\"33\",\"label\",\"Dates\",\"formattedValue\",\"\",\"_validate\",false,\"labelWidthUnit\",\"%\",\"invalid\",false,\"iconBefore\",\"bold/interface-calendar-remove\",\"endPlaceholder\",\"End date\",\"events\",[\"^14\",[]],\"textBetween\",\"-\",\"loading\",false,\"disabled\",false,\"labelPosition\",\"top\",\"labelWrap\",false,\"maintainSpaceWhenHidden\",false,\"required\",false]],\"^1<\",[\"^14\",[]],\"^1=\",[\"^0\",[\"^ \",\"n\",\"position2\",\"v\",[\"^ \",\"^16\",\"grid\",\"^1A\",\"container1\",\"^1E\",\"header\",\"^1F\",\"\",\"row\",1.6,\"col\",0,\"^1G\",0.2,\"^1H\",3,\"^1I\",0,\"^1J\",null]]],\"^1>\",null,\"^1?\",null,\"^1@\",null,\"^1A\",\"\",\"^7\",\"~m1730126891878\",\"^1B\",\"~m1730127780111\",\"^1C\",\"\",\"^1D\",null]]],\"table1\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"table1\",\"^15\",\"04613f37-bbbb-4f8a-a383-775f19cfcae5\",\"^16\",\"widget\",\"^17\",\"TableWidget2\",\"^18\",null,\"^19\",null,\"^1:\",null,\"^1;\",[\"^14\",[\"selectedRowKey\",null,\"_nextAfterCursor\",\"\",\"_columnBackgroundColor\",[\"^14\",[\"d6fb8\",\"\",\"0d708\",\"\",\"c4216\",\"\",\"150f3\",\"\",\"d5df6\",\"\",\"dfaf8\",\"\",\"7ef11\",\"\"]],\"_defaultSort\",null,\"_clearChangesetOnSave\",true,\"heightType\",\"fixed\",\"_columnTextColor\",[\"^14\",[\"d6fb8\",\"\",\"0d708\",\"\",\"c4216\",\"\",\"150f3\",\"\",\"d5df6\",\"\",\"dfaf8\",\"\",\"7ef11\",\"\"]],\"disableEdits\",false,\"autoColumnWidth\",false,\"_rowHeight\",\"small\",\"_columnIds\",[\"^B\",[\"d5df6\",\"150f3\",\"dfaf8\",\"c4216\",\"d6fb8\",\"0d708\",\"7ef11\"]],\"_isSaving\",false,\"_actionIds\",[\"^B\",[]],\"_clearChangeset\",false,\"caseSensitiveFiltering\",false,\"_limitOffsetRowCount\",null,\"selectedSourceRow\",null,\"_dynamicColumnsEnabled\",false,\"disableSave\",false,\"_columnEditableOptions\",[\"^14\",[\"d6fb8\",[\"^14\",[]],\"0d708\",[\"^14\",[]],\"c4216\",[\"^14\",[]],\"150f3\",[\"^14\",[]],\"d5df6\",[\"^14\",[]],\"dfaf8\",[\"^14\",[]],\"7ef11\",[\"^14\",[]]]],\"_toolbarPosition\",\"bottom\",\"_groupByColumns\",[\"^B\",[]],\"_toolbarButtonLabel\",[\"^14\",[\"1a\",\"Filter\",\"3c\",\"Download\"]],\"_nextBeforeCursor\",\"\",\"_persistRowSelection\",false,\"_toolbarButtonIcon\",[\"^14\",[\"1a\",\"bold/interface-text-formatting-filter-2\",\"3c\",\"bold/interface-download-button-2\"]],\"changesetArray\",[],\"groupByColumns\",[],\"_toolbarButtonType\",[\"^14\",[\"1a\",\"filter\",\"3c\",\"custom\"]],\"_columnOptionList\",[\"^14\",[\"d6fb8\",[\"^14\",[]],\"0d708\",[\"^14\",[]],\"c4216\",[\"^14\",[]],\"150f3\",[\"^14\",[]],\"d5df6\",[\"^14\",[]],\"dfaf8\",[\"^14\",[]],\"7ef11\",[\"^14\",[]]]],\"_columnValueOverride\",[\"^14\",[\"d6fb8\",\"{{ currentSourceRow.invoiceAmount }}\",\"0d708\",\"{{ currentSourceRow.invoiceCurrency }}\",\"c4216\",\"{{ currentSourceRow.folioId }}\",\"150f3\",\"{{ currentSourceRow.number }}\",\"d5df6\",\"{{ currentSourceRow.stayInfo.reservationId }}\",\"dfaf8\",\"\",\"7ef11\",\"{{ currentSourceRow.errors }}\"]],\"_showBorder\",true,\"_templatePageSize\",null,\"_dynamicColumnProperties\",[\"^14\",[]],\"_showHeader\",true,\"_currentPage\",0,\"overflowActionsOverlayMinWidth\",null,\"_actionsOverflowPosition\",0,\"_columnKey\",[\"^14\",[\"d6fb8\",\"\",\"0d708\",\"\",\"c4216\",\"folioId\",\"150f3\",\"number\",\"d5df6\",\"\",\"dfaf8\",\"invoiceDate\",\"7ef11\",\"errors\"]],\"hidden\",\"\",\"_toolbarButtonIds\",[\"^B\",[\"1a\",\"3c\"]],\"columnOrdering\",[],\"data\",\"{{ filterRenderedInvoicesFromFolios.data }}\",\"_cellSelection\",\"none\",\"_serverPaginated\",false,\"_linkedFilterId\",null,\"searchMode\",\"fuzzy\",\"_columnCellTooltip\",[\"^14\",[\"d6fb8\",\"\",\"0d708\",\"\",\"c4216\",\"\",\"150f3\",\"\",\"d5df6\",\"\",\"dfaf8\",\"\",\"7ef11\",\"\"]],\"_columnFormat\",[\"^14\",[\"d6fb8\",\"string\",\"0d708\",\"string\",\"c4216\",\"string\",\"150f3\",\"string\",\"d5df6\",\"string\",\"dfaf8\",\"date\",\"7ef11\",\"string\"]],\"_cursorCache\",[\"^ \"],\"_calculatedPageSize\",null,\"_primaryKeyColumnId\",\"93c23\",\"selectedDataIndex\",null,\"_columnAlignment\",[\"^14\",[\"d6fb8\",\"left\",\"0d708\",\"left\",\"c4216\",\"left\",\"150f3\",\"left\",\"d5df6\",\"left\",\"dfaf8\",\"left\",\"7ef11\",\"left\"]],\"_actionIcon\",[\"^14\",[]],\"margin\",\"4px 8px\",\"_columnTooltip\",[\"^14\",[\"d6fb8\",\"\",\"0d708\",\"\",\"c4216\",\"\",\"150f3\",\"\",\"d5df6\",\"\",\"dfaf8\",\"\",\"7ef11\",\"\"]],\"_columnIcon\",[\"^14\",[\"d6fb8\",\"\",\"0d708\",\"\",\"c4216\",\"\",\"150f3\",\"\",\"d5df6\",\"\",\"dfaf8\",\"\",\"7ef11\",\"\"]],\"_alwaysShowRowSelectionCheckboxes\",false,\"_columnCellTooltipMode\",[\"^14\",[\"d6fb8\",\"\",\"0d708\",\"\",\"c4216\",\"\",\"150f3\",\"\",\"d5df6\",\"\",\"dfaf8\",\"\",\"7ef11\",\"\"]],\"_pageSize\",null,\"showInEditor\",false,\"_isAddingNewRows\",false,\"selectedSourceRows\",[],\"_enableExpandableRows\",false,\"_selectMultipleRowsOnActionClick\",\"no\",\"_columnSortDisabled\",[\"^14\",[\"d6fb8\",false,\"0d708\",false,\"c4216\",false,\"150f3\",false,\"d5df6\",false,\"dfaf8\",false,\"7ef11\",false]],\"_showSummaryRow\",false,\"filterStack\",null,\"_expandedRows\",null,\"changesetObject\",null,\"_actionDisabled\",[\"^14\",[]],\"_columnReferenceId\",[\"^14\",[\"d6fb8\",\"amount\",\"0d708\",\"currency\",\"c4216\",\"folioId\",\"150f3\",\"invoiceNumber\",\"d5df6\",\"reservationId\",\"dfaf8\",\"invoiceDate\",\"7ef11\",\"invoice\"]],\"_dynamicColumnSource\",[],\"_rowSelection\",\"single\",\"_columnCaption\",[\"^14\",[\"d6fb8\",\"\",\"0d708\",\"\",\"c4216\",\"\",\"150f3\",\"\",\"d5df6\",\"\",\"dfaf8\",\"\",\"7ef11\",\"\"]],\"_dynamicColumnFormatOptions\",[\"^14\",[]],\"_dynamicRowHeights\",false,\"_columnFormatOptions\",[\"^14\",[\"d6fb8\",[\"^14\",[]],\"0d708\",[\"^14\",[]],\"c4216\",[\"^14\",[]],\"150f3\",[\"^14\",[]],\"d5df6\",[\"^14\",[]],\"dfaf8\",[\"^14\",[]],\"7ef11\",[\"^14\",[]]]],\"_changeset\",null,\"_afterCursor\",\"\",\"selectedRowKeys\",[],\"_beforeCursor\",\"\",\"_columnSummaryAggregationMode\",[\"^14\",[\"d6fb8\",\"none\",\"0d708\",\"none\",\"c4216\",\"none\",\"150f3\",\"none\",\"d5df6\",\"none\",\"dfaf8\",\"none\",\"7ef11\",\"none\"]],\"searchTerm\",\"{{ searchBar.value }}\",\"selectedRows\",[],\"_disabledVirtualization\",false,\"_expandedRowDataIndexes\",[],\"_showColumnBorders\",false,\"_columnStatusIndicatorOptions\",[\"^14\",[\"d6fb8\",[\"^14\",[]],\"0d708\",[\"^14\",[]],\"c4216\",[\"^14\",[]],\"150f3\",[\"^14\",[]],\"d5df6\",[\"^14\",[]],\"dfaf8\",[\"^14\",[]],\"7ef11\",[\"^14\",[]]]],\"overflowActionsOverlayMaxHeight\",null,\"_columnSize\",[\"^14\",[\"d5df6\",137,\"150f3\",116,\"c4216\",150,\"d6fb8\",105,\"0d708\",100,\"dfaf8\",100,\"7ef11\",100]],\"_serverPaginationType\",\"limitOffsetBased\",\"_columnSortMode\",[\"^14\",[\"d6fb8\",\"default\",\"0d708\",\"default\",\"c4216\",\"default\",\"150f3\",\"default\",\"d5df6\",\"default\",\"dfaf8\",\"default\",\"7ef11\",\"default\"]],\"_selectSingleRowsOnActionClick\",\"replace\",\"_showFooter\",true,\"_groupedColumnConfig\",[\"^14\",[]],\"_dynamicColumnSize\",[\"^14\",[]],\"_virtualizeStartIndex\",0,\"_toolbarButtonHidden\",[\"^14\",[\"1a\",\"\",\"3c\",\"\"]],\"_defaultFilters\",[\"^14\",[]],\"events\",[\"^B\",[[\"^14\",[\"event\",\"clickRow\",\"type\",\"util\",\"method\",\"openUrl\",\"pluginId\",\"\",\"targetId\",null,\"params\",[\"^14\",[\"url\",\"https://app.apaleo.com/{{ currentSourceRow.propertyId }}/reservations/{{ currentSourceRow.stayInfo.reservationId }}/folio\"]],\"waitType\",\"debounce\",\"waitMs\",\"0\"]],[\"^14\",[\"type\",\"widget\",\"waitMs\",\"0\",\"waitType\",\"debounce\",\"event\",\"clickToolbar\",\"method\",\"exportData\",\"pluginId\",\"table1\",\"targetId\",\"3c\"]]]],\"_columnEditable\",[\"^14\",[\"d6fb8\",\"\",\"0d708\",\"\",\"c4216\",\"\",\"150f3\",\"\",\"d5df6\",\"\",\"dfaf8\",\"\",\"7ef11\",\"\"]],\"newRows\",[],\"_rowBackgroundColor\",[],\"emptyMessage\",\"{{ filterRenderedInvoicesFromFolios.data == null ? \\\"\\\" : \\\"No invoices found\\\"}}\",\"pagination\",null,\"selectedDataIndexes\",[],\"_columnEditableInNewRows\",[\"^14\",[\"d6fb8\",\"\",\"0d708\",\"\",\"c4216\",\"\",\"150f3\",\"\",\"d5df6\",\"\",\"dfaf8\",\"\",\"7ef11\",\"\"]],\"_columnGroupAggregationMode\",[\"^14\",[\"d6fb8\",\"none\",\"0d708\",\"none\",\"c4216\",\"none\",\"150f3\",\"none\",\"d5df6\",\"none\",\"dfaf8\",\"none\",\"7ef11\",\"none\"]],\"sortArray\",[],\"_selectedCell\",null,\"overflowType\",\"scroll\",\"selectedCell\",null,\"_defaultSelectedRow\",[\"^14\",[\"mode\",\"index\",\"indexType\",\"display\",\"index\",0]],\"_hasNextPage\",false,\"_includeRowInChangesetArray\",false,\"_columnPosition\",[\"^14\",[\"d6fb8\",\"center\",\"0d708\",\"center\",\"c4216\",\"center\",\"150f3\",\"center\",\"d5df6\",\"center\",\"dfaf8\",\"center\",\"7ef11\",\"center\"]],\"_enableSaveActions\",true,\"_columnPlaceholder\",[\"^14\",[\"d6fb8\",\"Enter value\",\"0d708\",\"Enter value\",\"c4216\",\"Enter value\",\"150f3\",\"Enter value\",\"d5df6\",\"Enter value\",\"dfaf8\",\"Enter value\",\"7ef11\",\"Enter value\"]],\"_defaultFilterOperator\",\"and\",\"_actionLabel\",[\"^14\",[]],\"_virtualizeEndIndex\",0,\"selectedRow\",null,\"_actionHidden\",[\"^14\",[]],\"maintainSpaceWhenHidden\",false,\"_columnHidden\",[\"^14\",[\"d6fb8\",\"\",\"0d708\",\"\",\"c4216\",\"\",\"150f3\",\"\",\"d5df6\",\"\",\"dfaf8\",\"\",\"7ef11\",\"\"]],\"_columnLabel\",[\"^14\",[\"d6fb8\",\"Amount\",\"0d708\",\"Currency\",\"c4216\",\"Folio ID\",\"150f3\",\"Invoice Number\",\"d5df6\",\"Reservation ID\",\"dfaf8\",\"Invoice date\",\"7ef11\",\"Errors\"]],\"_showToolbar\",true]],\"^1<\",[\"^14\",[]],\"^1=\",[\"^0\",[\"^ \",\"n\",\"position2\",\"v\",[\"^ \",\"^16\",\"stack\",\"^1A\",\"container1\",\"^1E\",\"body\",\"^1F\",\"04101\",\"row\",5.8,\"col\",4,\"^1G\",8,\"^1H\",8,\"^1I\",0,\"^1J\",[\"^ \",\"^1K\",0,\"^1L\",\"fixed\",\"^1H\",660,\"^1G\",320]]]],\"^1>\",null,\"^1?\",null,\"^1@\",null,\"^1A\",\"\",\"^7\",\"~m1730131998336\",\"^1B\",\"~m1730905050175\",\"^1C\",\"\",\"^1D\",null]]],\"text1\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"text1\",\"^15\",\"bbf76fb9-24fd-440a-b16f-6c2aeea693e2\",\"^16\",\"widget\",\"^17\",\"TextWidget2\",\"^18\",null,\"^19\",null,\"^1:\",null,\"^1;\",[\"^14\",[\"heightType\",\"auto\",\"horizontalAlign\",\"left\",\"hidden\",false,\"imageWidth\",\"fit\",\"margin\",\"4px 8px\",\"showInEditor\",false,\"verticalAlign\",\"center\",\"tooltipText\",\"\",\"value\",\"**There are {{ filterRenderedInvoicesFromFolios.data.length }} invoices that need processing**\",\"disableMarkdown\",false,\"overflowType\",\"scroll\",\"maintainSpaceWhenHidden\",false]],\"^1<\",[\"^14\",[]],\"^1=\",[\"^0\",[\"^ \",\"n\",\"position2\",\"v\",[\"^ \",\"^16\",\"grid\",\"^1A\",\"container1\",\"^1E\",\"header\",\"^1F\",\"\",\"row\",1,\"col\",0,\"^1G\",0.6,\"^1H\",4,\"^1I\",0,\"^1J\",null]]],\"^1>\",null,\"^1?\",null,\"^1@\",null,\"^1A\",\"\",\"^7\",\"~m1730362586089\",\"^1B\",\"~m1730379407365\",\"^1C\",\"\",\"^1D\",null]]],\"searchBar\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"searchBar\",\"^15\",\"3db8cfe2-e46a-4939-ad6f-28b3ff240e3f\",\"^16\",\"widget\",\"^17\",\"TextInputWidget2\",\"^18\",null,\"^19\",null,\"^1:\",null,\"^1;\",[\"^14\",[\"spellCheck\",false,\"readOnly\",false,\"iconAfter\",\"\",\"showCharacterCount\",false,\"autoComplete\",false,\"enforceMaxLength\",false,\"maxLength\",null,\"hidden\",false,\"customValidation\",\"\",\"patternType\",\"\",\"hideValidationMessage\",false,\"textBefore\",\"\",\"validationMessage\",\"\",\"margin\",\"4px 8px\",\"textAfter\",\"\",\"showInEditor\",false,\"showClear\",false,\"pattern\",\"\",\"tooltipText\",\"\",\"labelAlign\",\"left\",\"formDataKey\",\"{{ self.id }}\",\"value\",\"\",\"labelCaption\",\"\",\"labelWidth\",\"33\",\"autoFill\",\"\",\"placeholder\",\"Search for Reservation ID, Invoice Number or Folio ID\",\"label\",\"Search\",\"_validate\",false,\"labelWidthUnit\",\"%\",\"invalid\",false,\"iconBefore\",\"\",\"minLength\",null,\"inputTooltip\",\"\",\"events\",[\"^14\",[]],\"autoCapitalize\",\"none\",\"loading\",false,\"disabled\",false,\"labelPosition\",\"top\",\"labelWrap\",false,\"maintainSpaceWhenHidden\",false,\"required\",false]],\"^1<\",[\"^14\",[]],\"^1=\",[\"^0\",[\"^ \",\"n\",\"position2\",\"v\",[\"^ \",\"^16\",\"grid\",\"^1A\",\"container1\",\"^1E\",\"header\",\"^1F\",\"\",\"row\",1.6,\"col\",3,\"^1G\",0.2,\"^1H\",9,\"^1I\",0,\"^1J\",null]]],\"^1>\",null,\"^1?\",null,\"^1@\",null,\"^1A\",\"\",\"^7\",\"~m1730379454261\",\"^1B\",\"~m1730383600753\",\"^1C\",\"\",\"^1D\",null]]]]],\"preloadedAppJavaScript\",null,\"preloadedAppJSLinks\",[],\"queryStatusVisibility\",false,\"responsiveLayoutDisabled\",false,\"rootScreen\",null,\"savePlatform\",\"web\",\"shortlink\",null,\"testEntities\",[],\"tests\",[],\"urlFragmentDefinitions\",[\"^B\",[]],\"version\",\"3.114.0\"]]]"},"changesRecord":[{"type":"DATASOURCE_TYPE_CHANGE","payload":{"newType":"JavascriptQuery","pluginId":"filterRenderedInvoicesFromFolios","resourceName":"JavascriptQuery"}},{"type":"WIDGET_TEMPLATE_UPDATE","payload":{"plugin":{"id":"filterRenderedInvoicesFromFolios","type":"datasource","uuid":null,"style":null,"folder":"","screen":null,"subtype":"JavascriptQuery","tabIndex":null,"template":{"data":null,"error":null,"query":"","events":[],"rawData":null,"finished":null,"metadata":null,"changeset":"","timestamp":0,"isFetching":false,"isImported":false,"cacheKeyTtl":"","transformer":"return data","queryRunTime":null,"queryTimeout":"10000","allowedGroups":[],"enableCaching":false,"privateParams":[],"queryDisabled":"","watchedParams":[],"streamResponse":false,"successMessage":"","allowedGroupIds":[],"changesetObject":"","servedFromCache":false,"_additionalScope":[],"errorTransformer":"return data.error","offlineQueryType":"None","queryRefreshTime":"","runWhenPageLoads":false,"changesetIsObject":false,"enableTransformer":false,"queryThrottleTime":"750","queryTriggerDelay":"0","showFailureToaster":true,"showSuccessToaster":true,"importedQueryInputs":{},"playgroundQueryUuid":"","requireConfirmation":false,"runWhenModelUpdates":false,"workflowRunBodyType":"raw","notificationDuration":"","queryDisabledMessage":"","requestSentTimestamp":null,"resourceNameOverride":"","importedQueryDefaults":{},"playgroundQuerySaveId":"latest","runWhenPageLoadsDelay":"","enableErrorTransformer":false,"offlineUserQueryInputs":"","queryFailureConditions":"","queryRunOnSelectorUpdate":false,"updateSetValueDynamically":false,"overrideOrgCacheForUserCache":false,"showLatestVersionUpdatedWarning":false,"showUpdateSetValueDynamicallyToggle":true},"container":"","createdAt":"2024-10-29T10:13:47.293Z","namespace":null,"position2":null,"updatedAt":"2024-11-06T15:04:09.780Z","resourceName":"JavascriptQuery","mobilePosition2":null,"mobileAppPosition":null,"resourceDisplayName":null},"update":{"data":null,"error":null,"query":"// This script orchestrates the endpoints needed to see failed invoices that haven't been rendered\n// 1. Fetch all failed invoices in a date range (getFailedInvoices)\n// 2. Fetch \"Rendered\" invoices in the same date range (getRenderedInvoices)\n// 3. Remove rendered invoices from the failed invoices using the folio ids, \n// 4. Only show the latest invoice from the same folio\n// 5. Query Retool database to see if there is failure reason for an invoice.\n\nasync function findUnrenderedInvoices(failedInvoices, renderedInvoices) {\n  // Create a Set of \"folioId\" values from renderedInvoices\n  const renderedFolioIds = new Set(renderedInvoices.map(invoice => invoice.folioId));\n\n  // Filter failedInvoices to only include those with folioId not in renderedFolioIds\n  const unrenderedInvoices = failedInvoices.filter(invoice => !renderedFolioIds.has(invoice.folioId));\n\n  // Reduce to keep only the latest invoice for each unique folioId\n  const uniqueLatestInvoices = unrenderedInvoices.reduce((acc, invoice) => {\n\n    const existingInvoice = acc.find(item => item.folioId === invoice.folioId);\n\n    if (!existingInvoice || new Date(invoice.invoiceDate) > new Date(existingInvoice.invoiceDate)) {\n      return [\n        ...acc.filter(item => item.folioId !== invoice.folioId),\n        invoice\n      ];\n    }\n      \n    return acc;\n  }, []);\n\n  // Get all invoice numbers for database query\n  const invoiceNumbersArr = uniqueLatestInvoices.reduce((acc, invoice) => {\n    if (invoice.number != null) {\n      acc.push(invoice.number);\n    }\n    return acc\n  }, [])\n\n  \n  \n  let errorMap = new Map();\n\n  // Query the Retool database for errors\n  async function callGetInvoiceErrors() {\n    return await getInvoiceErrors.trigger({\n      onSuccess: (data) => {\n        console.log(\"Data is\", data)\n      },\n      onFailure: (error) => {\n        console.log(\"Error is\", error)\n      },\n      additionalScope: {\n        invoiceNumbers: invoiceNumbersArr\n      } \n    });\n  }\n  \n  if (invoiceNumbersArr.length > 0) {\n    const errorResults = await callGetInvoiceErrors();\n    console.log(errorResults)\n    // Create a map of invoice_number to errors for easy lookup\n    console.log(\"retrieved data\", errorResults)\n\n    const formattedErrors = formatDataAsArray(errorResults)\n    \n    errorMap = new Map(\n      formattedErrors.map(invoice => [invoice.invoice_number, invoice.errors])\n    );\n  }\n\n  // Add errors property to all invoices (null if no errors found)\n  const invoicesWithErrors = uniqueLatestInvoices.map(invoice => ({\n    ...invoice,\n    errors: errorMap.get(invoice.number) || null\n  }));\n\n  return invoicesWithErrors;\n}\n\nconst failedInvoices = getFailedInvoices.data;\nconst renderedInvoices = getRenderedInvoices.data;\nconst unrenderedInvoices = findUnrenderedInvoices(failedInvoices, renderedInvoices);\n\n\nreturn unrenderedInvoices;","events":[],"rawData":null,"finished":null,"metadata":null,"changeset":"","timestamp":0,"isFetching":false,"isImported":false,"workflowId":null,"cacheKeyTtl":"","transformer":"return data","queryRunTime":null,"queryTimeout":"10000","allowedGroups":[],"enableCaching":false,"privateParams":[],"queryDisabled":"","watchedParams":[],"streamResponse":false,"successMessage":"","workflowParams":null,"allowedGroupIds":[],"changesetObject":"","servedFromCache":false,"_additionalScope":[],"errorTransformer":"return data.error","offlineQueryType":"None","queryRefreshTime":"","runWhenPageLoads":false,"changesetIsObject":false,"enableTransformer":false,"playgroundQueryId":null,"queryThrottleTime":"750","queryTriggerDelay":"0","showFailureToaster":true,"showSuccessToaster":false,"confirmationMessage":null,"importedQueryInputs":{},"isMultiplayerEdited":false,"playgroundQueryUuid":"","requireConfirmation":false,"runWhenModelUpdates":false,"workflowRunBodyType":"raw","notificationDuration":4.5,"queryDisabledMessage":"","requestSentTimestamp":null,"resourceNameOverride":"","resourceTypeOverride":null,"importedQueryDefaults":{},"playgroundQuerySaveId":"latest","runWhenPageLoadsDelay":"","enableErrorTransformer":false,"offlineUserQueryInputs":"","queryFailureConditions":"","queryRunOnSelectorUpdate":false,"offlineOptimisticResponse":null,"updateSetValueDynamically":false,"lastReceivedFromResourceAt":null,"overrideOrgCacheForUserCache":false,"showLatestVersionUpdatedWarning":false,"showUpdateSetValueDynamicallyToggle":true},"widgetId":"filterRenderedInvoicesFromFolios","shouldRecalculateTemplate":true},"isUserTriggered":true}],"gitSha":null,"checksum":null,"createdAt":"2024-11-06T15:04:29.061Z","updatedAt":"2024-11-06T15:04:29.061Z","pageId":3590655,"userId":266540},"modules":{}}
